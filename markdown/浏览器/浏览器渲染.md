# 浏览器渲染

浏览器是多进程。

* 浏览器进程（负责管理各个标签页的创建和销毁；页面的显示和功能；资源的管理和下载）
* 第三方插件进程
* gpu进程
* 浏览器渲染进程

## 浏览器渲染进程

主要负责：

* 解析html文件和css文件，加载图片等资源文件，渲染成用户看到的页面
* 执行解析js文件的脚本代码

该过程会有多个线程协作完成，主要线程以及作用如下：

1. GUI渲染线程
    负责解析html文件构建DOM树，解析CSS，结合DOM树渲染成RenderObject树，然后布局和绘制页面。

    当RenderObject树需要更新样式属性，发生Repaint；当树中元素规则尺寸，布局或显示隐藏等发生变化，即发生Reflow。

2. JS引擎线程

3. 时间出发线程

4. 定时器触发线程

5. 异步Http请求线程

注意： *GUI渲染线程和JS引擎线程是互斥的*

## GUI渲染线程

1. 解析html文件，构建dom树，同时浏览器主进程负责下载css文件

2. css文件下载完成，解析css文件成树形的数据结构，然后结合dom树合并成RenderObject树

3. 布局RenderObejct树，负责RenderObject树中的元素尺寸，位置等计算

4. 绘制RenderObject树，绘制页面的像素信息

5. 浏览器主进程将默认的图层和复合涂层交给gpu进程，gpu进程再将各个图层合成，显示出页面。

    **默认图层是普通文档流，复合图层指的是video，iframe，canvas，webgl等元素。使用复合图层可以进行硬件加速，避免了默认图层的重绘和回流。**

（复合图层和默认图层的进一步研究链接）